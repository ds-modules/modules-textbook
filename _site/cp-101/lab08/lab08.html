<!DOCTYPE html>
<html lang="en">
  

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>Lab 8</title>
  <meta name="description" content="Web ScrapingIn today’s lab, we are going to download data from the internet using an API. API stands for application programming interface. Companies often c...">

  <link rel="canonical" href="http://ds-modules.github.io/modules-textbook/cp-101/lab08/lab08.html">
  <link rel="alternate" type="application/rss+xml" title="UC Berkeley Data Science Modules" href="http://ds-modules.github.io/modules-textbook/feed.xml">

  <meta property="og:url"         content="http://ds-modules.github.io/modules-textbook/cp-101/lab08/lab08.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Lab 8" />
<meta property="og:description" content="Web ScrapingIn today’s lab, we are going to download data from the internet using an API. API stands for application programming interface. Companies often c..." />
<meta property="og:image"       content="" />


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage":
    "http://ds-modules.github.io/modules-textbook/cp-101/lab08/lab08.html",
  "headline":
    "Lab 8",
  "datePublished":
    "2019-10-31T10:01:27-07:00",
  "dateModified":
    "2019-10-31T10:01:27-07:00",
  "description":
    "Web ScrapingIn today’s lab, we are going to download data from the internet using an API. API stands for application programming interface. Companies often c...",
  "author": {
    "@type": "Person",
    "name": "Alex Nakagawa"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "http://ds-modules.github.io/modules-textbook",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "http://ds-modules.github.io/modules-textbook",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/modules-textbook/assets/css/styles.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css ">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/modules-textbook/images/logo/favicon.ico">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    CommonHTML: {
        linebreaks: {
            automatic: true,
        },
    },
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML' async></script>

  <!-- DOM updating function -->
  <script>
const runWhenDOMLoaded = cb => {
  if (document.readyState != 'loading') {
    cb()
  } else if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', cb)
  } else {
    document.attachEvent('onreadystatechange', function() {
      if (document.readyState == 'complete') cb()
    })
  }
}

// Helper function to init things quickly
initFunction = function(myfunc) {
  runWhenDOMLoaded(myfunc);
  document.addEventListener('turbolinks:load', myfunc);
};
</script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '/modules-textbook';
  </script>

  <!-- Add AnchorJS to let headers be linked -->
  <script src="/modules-textbook/assets/js/anchor.min.js"  type="text/javascript"></script>
  <script>

initFunction(function () {
    anchors.add("main h1, main h2, main h3, main h4")
});

</script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="/modules-textbook/assets/js/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  <script src="https://unpkg.com/nbinteract-core" async></script>

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->

<script type="text/x-thebe-config">
    {
      requestKernel: true,
      binderOptions: {
        repo: 'ds-modules/modules-textbook',
        ref: 'master',
      },
      kernelOptions: {
        name: 'python3',
      }
    }
</script>
<script src="https://unpkg.com/thebelab@0.3.3/lib/index.js"></script>
<script>
    /**
     * Add attributes to Thebelab blocks
     */

    const initThebelab = () => {
        const addThebelabToCodeCells = () => {
            console.log("Adding thebelab to code cells...");
            // If Thebelab hasn't loaded, wait a bit and try again. This
            // happens because we load ClipboardJS asynchronously.
            if (window.thebelab === undefined) {
                setTimeout(addThebelabToCodeCells, 250)
            return
            }

            // If we already detect a Thebelab cell, don't re-run
            if (document.querySelectorAll('div.thebelab-cell').length > 0) {
                return;
            }

            // Find all code cells, replace with Thebelab interactive code cells
            const codeCells = document.querySelectorAll('.input_area pre')
            codeCells.forEach((codeCell, index) => {
                const id = codeCellId(index)
                codeCell.setAttribute('data-executable', 'true')

                // Figure out the language it uses and add this too
                var parentDiv = codeCell.parentElement.parentElement;
                var arrayLength = parentDiv.classList.length;
                for (var ii = 0; ii < arrayLength; ii++) {
                    var parts = parentDiv.classList[ii].split('language-');
                    if (parts.length === 2) {
                        // If found, assign dataLanguage and break the loop
                        var dataLanguage = parts[1];
                        break;
                    }
                }
                codeCell.setAttribute('data-language', dataLanguage)

                // If the code cell is hidden, show it
                var inputCheckbox = document.querySelector(`input#hidebtn${codeCell.id}`);
                if (inputCheckbox !== null) {
                    setCodeCellVisibility(inputCheckbox, 'visible');
                }
            });

            // Remove the event listener from the page so keyboard press doesn't
            // Change page
            document.removeEventListener('keydown', initPageNav)
            keyboardListener = false;

            // Init thebelab
            thebelab.bootstrap();

            // Remove copy buttons since they won't work anymore
            const copyButtons = document.querySelectorAll('.copybtn')
            copyButtons.forEach((copyButton, index) => {
                copyButton.remove();
            });

            // Remove outputs since they'll be stale
            const outputs = document.querySelectorAll('.output *, .output')
            outputs.forEach((output, index) => {
                output.remove();
            });
        }

        // Add event listener for the function to modify code cells
        const thebelabButton = document.getElementById('interact-button-thebelab');
        if (thebelabButton === null) {
            setTimeout(initThebelab, 250)
        return
        };
        thebelabButton.addEventListener('click', addThebelabToCodeCells);
    }

    // Initialize Thebelab
    initFunction(initThebelab);
</script>


  <!-- Google analytics -->
  <script src="/modules-textbook/assets/js/ga.js" async></script>

  <!-- Clipboard copy button -->
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" async></script>

  <!-- Load JS that depends on site variables -->
  <script>
/**
 * Set up copy/paste for code blocks
 */
const codeCellId = index => `codecell${index}`

const clipboardButton = id =>
  `<a class="btn copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#${id}">
    <img src="/modules-textbook/assets/images/copy-button.svg" alt="Copy to clipboard">
  </a>`

// Clears selected text since ClipboardJS will select the text when copying
const clearSelection = () => {
  if (window.getSelection) {
    window.getSelection().removeAllRanges()
  } else if (document.selection) {
    document.selection.empty()
  }
}

// Changes tooltip text for two seconds, then changes it back
const temporarilyChangeTooltip = (el, newText) => {
  const oldText = el.getAttribute('data-tooltip')
  el.setAttribute('data-tooltip', newText)
  setTimeout(() => el.setAttribute('data-tooltip', oldText), 2000)
}

const addCopyButtonToCodeCells = () => {
  // If ClipboardJS hasn't loaded, wait a bit and try again. This
  // happens because we load ClipboardJS asynchronously.
  if (window.ClipboardJS === undefined) {
    setTimeout(addCopyButtonToCodeCells, 250)
    return
  }

  const codeCells = document.querySelectorAll('div.highlighter-rouge:not(.output) pre')
  codeCells.forEach((codeCell, index) => {
    const id = codeCellId(index)
    codeCell.setAttribute('id', id)
    if (document.querySelector(`pre#${id} + a`) == null) {
      codeCell.insertAdjacentHTML('afterend', clipboardButton(id));
    }
  })

  const clipboard = new ClipboardJS('.copybtn')
  clipboard.on('success', event => {
    clearSelection()
    temporarilyChangeTooltip(event.trigger, 'Copied!')
  })

  clipboard.on('error', event => {
    temporarilyChangeTooltip(event.trigger, 'Failed to copy')
  })

  // Get rid of clipboard before the next page visit to avoid memory leak
  document.addEventListener('turbolinks:before-visit', () =>
    clipboard.destroy()
  )
}

initFunction(addCopyButtonToCodeCells);
</script>

  <!-- Hide cell code -->
  
<script>
/**
Add buttons to hide code cells
*/


var setCodeCellVisibility = function(inputField, kind) {
    // Update the image and class for hidden
    var id = inputField.getAttribute('data-id');
    var codeCell = document.querySelector(`#${id}`);

    if (kind === "visible") {
        codeCell.classList.remove('hidden');
        inputField.checked = true;
    } else {
        codeCell.classList.add('hidden');
        inputField.checked = false;
    }
}

var toggleCodeCellVisibility = function (event) {
    // The label is clicked, and now we decide what to do based on the input field's clicked status
    if (event.target.tagName === "LABEL") {
        var inputField = event.target.previousElementSibling;
    } else {
        // It is the span inside the target
        var inputField = event.target.parentElement.previousElementSibling;
    }

    if (inputField.checked === true) {
        setCodeCellVisibility(inputField, "visible");
    } else {
        setCodeCellVisibility(inputField, "hidden");
    }
}


// Button constructor
const hideCodeButton = id => `<input class="hidebtn" type="checkbox" id="hidebtn${id}" data-id="${id}"><label title="Toggle cell" for="hidebtn${id}" class="plusminus"><span class="pm_h"></span><span class="pm_v"></span></label>`

var addHideButton = function () {
  // If a hide button is already added, don't add another
  if (document.querySelector('div.hidecode input') !== null) {
      return;
  }

  // Find the input cells and add a hide button
  document.querySelectorAll('div.input_area div.highlight').forEach(function (item, index) {
    if (!item.parentElement.classList.contains("hidecode")) {
        // Skip the cell if it doesn't have a hidecode class
        return;
    }

    const id = codeCellId(index)
    item.setAttribute('id', id);
    item.insertAdjacentHTML('afterend', hideCodeButton(id))

    // Set up the visibility toggle
    hideLink = document.querySelector(`#${id} + input + label`);
    hideLink.addEventListener('click', toggleCodeCellVisibility)
  });
}


// Initialize the hide buttos
var initHiddenCells = function () {
    // Add hide buttons to the cells
    addHideButton();

    // Toggle the code cells that should be hidden
    document.querySelectorAll('div.hidecode input').forEach(function (item) {
        setCodeCellVisibility(item, 'hidden');
        item.checked = true;
    })
}

initFunction(initHiddenCells);

</script>


  <!-- Load custom website scripts -->
  <script src="/modules-textbook/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/modules-textbook/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/modules-textbook/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  
<script>
/**
  * To auto-embed hub URLs in interact links if given in a RESTful fashion
 */

function getJsonFromUrl(url) {
  var query = url.split('?');
  if (query.length < 2) {
    // No queries so just return false
    return false;
  }
  query = query[1];
  // Collect REST params into a dictionary
  var result = {};
  query.split("&").forEach(function(part) {
    var item = part.split("=");
    result[item[0]] = decodeURIComponent(item[1]);
  });
  return result;
}
    
function dict2param(dict) {
    params = Object.keys(dict).map(function(k) {
        return encodeURIComponent(k) + '=' + encodeURIComponent(dict[k])
    });
    return params.join('&')
}

// Parse a Binder URL, converting it to the string needed for JupyterHub
function binder2Jupyterhub(url) {
  newUrl = {};
  parts = url.split('v2/gh/')[1];
  // Grab the base repo information
  repoinfo = parts.split('?')[0];
  var [org, repo, ref] = repoinfo.split('/');
  newUrl['repo'] = ['https://github.com', org, repo].join('/');
  newUrl['branch'] = ref
  // Grab extra parameters passed
  params = getJsonFromUrl(url);
  if (params['filepath'] !== undefined) {
    newUrl['subPath'] = params['filepath']
  }
  return dict2param(newUrl);
}

// Filter out potentially unsafe characters to prevent xss
function safeUrl(url)
{
   return String(encodeURIComponent(url))
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
}

function addParamToInternalLinks(hub) {
  var links = document.querySelectorAll("a").forEach(function(link) {
    var href = link.href;
    // If the link is an internal link...
    if (href.search("http://ds-modules.github.io") !== -1 || href.startsWith('/') || href.search("127.0.0.1:") !== -1) {
      // Assume we're an internal link, add the hub param to it
      var params = getJsonFromUrl(href);
      if (params !== false) {
        // We have REST params, so append a new one
        params['jupyterhub'] = hub;
      } else {
        // Create the REST params
        params = {'jupyterhub': hub};
      }
      // Update the link
      var newHref = href.split('?')[0] + '?' + dict2param(params);
      link.setAttribute('href', decodeURIComponent(newHref));
    }
  });
  return false;
}


// Update interact links
function updateInteractLink() {
    // hack to make this work since it expects a ? in the URL
    rest = getJsonFromUrl("?" + location.search.substr(1));
    jupyterHubUrl = rest['jupyterhub'];
    var hubType = null;
    var hubUrl = null;
    if (jupyterHubUrl !== undefined) {
      hubType = 'jupyterhub';
      hubUrl = jupyterHubUrl;
    }

    if (hubType !== null) {
      // Sanitize the hubUrl
      hubUrl = safeUrl(hubUrl);

      // Add HTTP text if omitted
      if (hubUrl.indexOf('http') < 0) {hubUrl = 'http://' + hubUrl;}
      var interactButtons = document.querySelectorAll("button.interact-button")
      var lastButton = interactButtons[interactButtons.length-1];
      var link = lastButton.parentElement;

      // If we've already run this, skip the link updating
      if (link.nextElementSibling !== null) {
        return;
      }

      // Update the link and add context div
      var href = link.getAttribute('href');
      if (lastButton.id === 'interact-button-binder') {
        // If binder links exist, we need to re-work them for jupyterhub
        if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
          // If localhost, assume we're working from a local Jupyter server and remove `/hub`
          first = [hubUrl, 'git-sync'].join('/')
        } else {
          first = [hubUrl, 'hub', 'user-redirect', 'git-sync'].join('/')
        }
        href = first + '?' + binder2Jupyterhub(href);
      } else {
        // If interact button isn't binderhub, assume it's jupyterhub
        // If JupyterHub links, we only need to replace the hub url
        href = href.replace("https://datahub.berkeley.edu", hubUrl);
        if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
          // Assume we're working from a local Jupyter server and remove `/hub`
          href = href.replace("/hub/user-redirect", "");
        }
      }
      link.setAttribute('href', decodeURIComponent(href));

      // Add text after interact link saying where we're launching
      hubUrlNoHttp = decodeURIComponent(hubUrl).replace('http://', '').replace('https://', '');
      link.insertAdjacentHTML('afterend', '<div class="interact-context">on ' + hubUrlNoHttp + '</div>');

      // Update internal links so we retain the hub url
      addParamToInternalLinks(hubUrl);
    }
}

runWhenDOMLoaded(updateInteractLink)
document.addEventListener('turbolinks:load', updateInteractLink)
</script>


  <!-- Lunr search code - will only be executed on the /search page -->
  <script src="/modules-textbook/assets/js/lunr/lunr.min.js" type="text/javascript"></script>
  <script>var initQuery = function() {
  // See if we have a search box
  var searchInput = document.querySelector('input#lunr_search');
  if (searchInput === null) {
    return;
  }

  // Function to parse our lunr cache
  var idx = lunr(function () {
    this.field('title')
    this.field('excerpt')
    this.field('categories')
    this.field('tags')
    this.ref('id')

    this.pipeline.remove(lunr.trimmer)

    for (var item in store) {
      this.add({
        title: store[item].title,
        excerpt: store[item].excerpt,
        categories: store[item].categories,
        tags: store[item].tags,
        id: item
      })
    }
  });

  // Run search upon keyup
  searchInput.addEventListener('keyup', function () {
    var resultdiv = document.querySelector('#results');
    var query = document.querySelector("input#lunr_search").value.toLowerCase();
    var result =
      idx.query(function (q) {
        query.split(lunr.tokenizer.separator).forEach(function (term) {
          q.term(term, { boost: 100 })
          if(query.lastIndexOf(" ") != query.length-1){
            q.term(term, {  usePipeline: false, wildcard: lunr.Query.wildcard.TRAILING, boost: 10 })
          }
          if (term != ""){
            q.term(term, {  usePipeline: false, editDistance: 1, boost: 1 })
          }
        })
      });

      // Empty the results div
      while (resultdiv.firstChild) {
        resultdiv.removeChild(resultdiv.firstChild);
      }

    resultdiv.insertAdjacentHTML('afterbegin', '<p class="results__found">'+result.length+' Result(s) found</p>');
    for (var item in result) {
      var ref = result[item].ref;
      if(store[ref].teaser){
        var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<div class="archive__item-teaser">'+
                '<img src="'+store[ref].teaser+'" alt="">'+
              '</div>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      else{
    	  var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      resultdiv.insertAdjacentHTML('beforeend', searchitem);
    }
  });
};

initFunction(initQuery);
</script>
</head>

  <body>
    <!-- .js-show-sidebar shows sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      



<nav id="js-sidebar" class="c-textbook__sidebar">
  <a href="https://ds-modules.github.io/modules-textbook"><img src="/modules-textbook/images/logo/logo.png" class="textbook_logo" id="sidebar-logo" data-turbolinks-permanent/></a>
  <h2 class="c-sidebar__title">UC Berkeley Data Science Modules</h2>
  <ul class="c-sidebar__chapters">
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/intro.html"
        >
          
          Home
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="https://github.com/ds-modules/"
        >
          
          DSEP Modules Repository
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="https://ds-modules.github.io/curriculum-guide/intro"
        >
          
          Data Science Curriculum Guide
        </a>

        
      </li>

      
    
      
      
        <li class="c-sidebar__chapter"><a class="c-sidebar__entry" href="/modules-textbook/search.html">Search</a></li>
        
      
      
        <li class="c-sidebar__divider"></li>
        
      
      
        <li><h2 class="c-sidebar__title">Introduction</li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/introduction/ds-intro.html"
        >
          
          Data Science in Python and Jupyter
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/introduction/intro-module-final.html"
                >
                  
                  Intro to Python and Jupyter
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      
        <li><h2 class="c-sidebar__title">Social Sciences</li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/legalst-190/legalst-190-intro.html"
        >
          
          Legal Studies
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/legalst-190/1-18.html"
                >
                  
                  Intro to Python
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/legalst-190/ps1/SF_Crime_PSET1.html"
                >
                  
                  Problem Set 1
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/psych-167ac/psych-167ac-intro.html"
        >
          
          Psychology
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/psych-167ac/01-intro.html"
                >
                  
                  Introduction
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/psych-167ac/02-correlation-regression.html"
                >
                  
                  Correlation & Regression
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/psych-167ac/03-my-project.html"
                >
                  
                  My Project
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      
        <li><h2 class="c-sidebar__title">Arts and Humanities</li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/xenglish-r1a/xenglish-r1a-intro.html"
        >
          
          English
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/xenglish-r1a/01-Chinatowns.html"
                >
                  
                  Chinatowns
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      
        <li><h2 class="c-sidebar__title">Professional</li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/cp-101/cp-101-intro.html"
        >
          
          City Planning
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/cp-101/lab07/lab07.html"
                >
                  
                  Lab 7
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry c-sidebar__entry--active"
                  href="/modules-textbook/cp-101/lab08/lab08.html"
                >
                  
                  Lab 8
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/cp-101/lab09/lab09.html"
                >
                  
                  Lab 9
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/cp-101/lab10/lab10.html"
                >
                  
                  Lab 10
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
  </ul>
  <p class="sidebar_footer">Powered by <a href="https://github.com/jupyter/jupyter-book">Jupyter Book</a></p>
</nav>

      
      <!-- Shamelessly copied from minimal mistakes -->


<!-- TOC will only show up if it has at least one item -->


  <aside class="sidebar__right">
    <nav class="onthispage">
      <header><h4 class="nav__title"><i class="fa fa-list"></i>   On this page</h4></header>
      <ul class="toc__menu">
  <li><a href="#setup">Setup</a></li>
  <li><a href="#downloading-tweets">Downloading Tweets</a></li>
  <li><a href="#data-cleaning">Data Cleaning</a></li>
  <li><a href="#scraping-tweets-by-location">Scraping Tweets by Location</a></li>
  <li><a href="#temporal-data">Temporal Data</a></li>
  <li><a href="#sentiment-analysis">Sentiment Analysis</a></li>
  <li><a href="#your-turn">Your turn!</a>
    <ul>
      <li><a href="#authors-monica-wilkinson-and-vera-wang">Authors: Monica Wilkinson and Vera Wang</a></li>
    </ul>
  </li>
</ul>
    </nav>
  </aside>


      
      <main class="c-textbook__page" tabindex="-1">
          <div class="o-wrapper">
            <div class="c-sidebar-toggle">
  <!-- We show the sidebar by default so we use .is-active -->
  <button
    id="js-sidebar-toggle"
    class="hamburger hamburger--arrowalt is-active"
  >
    <span class="hamburger-box">
      <span class="hamburger-inner"></span>
    </span>
    <span class="c-sidebar-toggle__label">Toggle Sidebar</span>
  </button>
</div>

            
<div class="buttons">
<a href="/modules-textbook/content/cp-101/lab08/lab08.ipynb" download>
<button id="interact-button-download" class="interact-button">Download</button>
</a>

<button id="interact-button-thebelab" class="interact-button">Thebelab</button>








<a href="https://mybinder.org/v2/gh/ds-modules/modules-textbook/master?filepath=content%2Fcp-101%2Flab08%2Flab08.ipynb"><button class="interact-button" id="interact-button-binder"><img class="interact-button-logo" src="/modules-textbook/assets/images/logo_binder.svg" alt="Interact" />Binder</button></a>






<a href="https://datahub.berkeley.edu/hub/user-redirect/git-pull?repo=https://github.com//ds-modules/modules-textbook&amp;branch=master&amp;subPath=content%2Fcp-101%2Flab08%2Flab08.ipynb&amp;app=notebook"><button class="interact-button" id="interact-button-jupyterhub"><img class="interact-button-logo" src="/modules-textbook/assets/images/logo_jupyterhub.svg" alt="Interact" />DataHub</button></a>



</div>


            <div class="c-textbook__content">
              <h1 id="web-scraping">Web Scraping</h1>
<hr />
<p>In today’s lab, we are going to download data from the internet using an API. API stands for application programming interface. Companies often create APIs as a way to allow users to more directly interact with their servers to retrieve data. Today, we are going to be using Twitter’s API to download tweets to get some experience with larger datasets.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run this cell to set up your notebook</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c"># These are the utility functions in the twitter_utils.py file</span>
<span class="kn">from</span> <span class="nn">twitter_utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c"># Ensure that Pandas shows at least 280 characters in columns, so we can see full tweets</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'max_colwidth'</span><span class="p">,</span> <span class="mi">280</span><span class="p">)</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">json</span>
</code></pre></div></div>

<h2 id="setup">Setup</h2>
<hr />
<p>For this lab, we will be importing utility functions to interact with Twitter’s API. Underneath the hood, these utility functions use the <code class="highlighter-rouge">tweepy</code> package, which is the how you can interface with Twitter’s API using <code class="highlighter-rouge">python</code>. First, we need to install <code class="highlighter-rouge">tweepy</code> so that our utility functions will be able to use use it. If you have time at the end of this lab, you can look in the <code class="highlighter-rouge">twitter_utils.py</code> file in this folder and try to understand how the utility functions work.</p>

<p>Twitter requires you to have authentication keys to access their API.  To get your keys, you’ll have to sign up for a Twitter developer account. Note that <strong>anyone who has your authentication keys can post as you</strong>. In order to protect your keys, you will be storing them in a separate file, which we have called <code class="highlighter-rouge">keys.json</code>, and reading them into this notebook from that file. Also note that <strong>Twitter limits developers to a certain rate of data requests</strong>. This means that if you make too many API calls in a short period of time, Twitter may block you from retrieving data for a certain period of time. Avoid rerunning cells that retrieve new tweets.</p>

<p>Follow the instructions below to get your Twitter API keys.  <strong>Read the instructions completely before starting.</strong></p>

<ol>
  <li><a href="https://twitter.com">Create a Twitter account</a>.  You can use an existing account if you have one; if you prefer to not do this assignment under your regular account, feel free to create a throw-away account.</li>
  <li>Under account settings, add your phone number to the account.</li>
  <li><a href="https://dev.twitter.com/resources/signup">Create a Twitter developer account</a> by clicking the ‘Apply’ button on the top right of the page. Attach it to your Twitter account. You’ll have to fill out a form describing what you want to do with the developer account. Explain that you are doing this for a class at UC Berkeley and that you don’t know exactly what you’re building yet and just need the account to get started. These applications are approved by some sort of AI system, so it doesn’t matter exactly what you write.</li>
  <li>Once you’re logged into your developer account, <a href="https://apps.twitter.com/app/new">create an application for this assignment</a>.  You can call it whatever you want, and you can write any URL when it asks for a web site.  You don’t need to provide a callback URL.</li>
  <li>On the page for that application, find your Consumer Key and Consumer Secret.</li>
  <li>On the same page, create an Access Token.  Record the resulting Access Token and Access Token Secret.</li>
  <li>Edit the file <code class="highlighter-rouge">keys.json</code> in the same folder as this file and replace the placeholders with your keys.</li>
</ol>

<p>Now you should be all ready to go! Let’s test that you have correctly set up your developer account and the <code class="highlighter-rouge">keys.json</code> folder. The following cell loads your keys into this notebook, then validates them with the Twitter API. It should display your Twitter username without any warnings.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>
<span class="n">key_file</span> <span class="o">=</span> <span class="s">"keys.json"</span> <span class="c"># Add your keys to keys.json before running this cell</span>

<span class="c"># Loading your keys from keys.json</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">key_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c"># if you print or view the contents of keys be sure to delete the cell!</span>

<span class="c"># Validate keys.</span>
<span class="c"># If your notebook does not print out "The keys are valid. Your username is: &lt;your username&gt;"</span>
<span class="c"># you may have copied and pasted your keys incorrectly.</span>
<span class="n">validate_authentication</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</code></pre></div></div>

<p>If you are getting any errors in this cell, ask a TA for help. If you do not have valid keys, you will not be able to use the API.</p>

<h2 id="downloading-tweets">Downloading Tweets</h2>
<hr />
<p>Now we should be ready to download some tweets! In the following cell, we use one of the utility functions to download recent tweets with the hashtag “#gentrification”. This cell can take a few minutes to finish running.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Note that you do not write the actual hashtag symbol</span>
<span class="n">gentrification</span> <span class="o">=</span> <span class="n">download_recent_tweets_by_hashtag</span><span class="p">(</span><span class="n">hashtag</span> <span class="o">=</span> <span class="s">"gentrification"</span><span class="p">,</span>
                                                   <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">,</span>
                                                   <span class="n">count</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div></div>

<p>If you are running into errors downloading these tweets, uncomment and run the following cell to load in tweets that we scraped earlier.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># gentrification = load_tweets('gentrification.json')</span>
</code></pre></div></div>

<p>Similarly, if you download any datasets during this lab that you would like to save for later, you can use the <code class="highlighter-rouge">save_tweets()</code> function, which takes as its arguments a list of dictionaries and a name for the new file you are writing.</p>

<p>We now have <code class="highlighter-rouge">gentrification</code> assigned to a list with each element corresponding to a tweet. Let’s examine one of these elements to get a better understanding of our data.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># This accesses the first (zero index) element of the list</span>
<span class="n">gentrification</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<p>This is an example of another <code class="highlighter-rouge">python</code> data structure called a <em>dictionary</em>. Dictionaries store <em>values</em> by associating them with a <em>key</em> rather than by an integer index. You can access the values stored in a dictionary using bracket notation just like a list. For example:</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In this dictionary, the keys are strings, and the values are all numbers</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">'a'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">'b'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s">'c'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

<span class="n">d</span><span class="p">[</span><span class="s">'a'</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="data-cleaning">Data Cleaning</h2>
<hr />
<p>The dictionary we were looking at above is a little bit hard to interpret because there dictionaries nested inside of some our keys. We can look only at the first level of keys in our dictionary by using the <code class="highlighter-rouge">.keys()</code> method.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gentrification</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="c"># You can also use .values() to access all of the values</span>
</code></pre></div></div>

<p>Unfortunately, Twitter by default does not attach geographic data to the metadata of each tweet. To get around this, we can use the location associated to the account of each poster. First, we want to extract only the parts of the data that are relevant to what we are looking for. To do this, we first need to turn our list of dictionaries into a <code class="highlighter-rouge">pandas DataFrame</code>. Fortunately, there is a function that can do this easily for us.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gentrification_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">gentrification</span><span class="p">)</span>
<span class="n">gentrification_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Next, we want to extract out only the columns that are relevant to us. Discarding columns that do not help us answer our question can be helpful because it prevents the computer from having to do unnecessary computations. However, if we want to be able to connect any conclusions we make after we get rid of columns, it is helpful to keep an identifying column in your <code class="highlighter-rouge">DataFrame</code> even if you are not performing analyses on it.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">users</span> <span class="o">=</span> <span class="n">gentrification_df</span><span class="p">[[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'user'</span><span class="p">]]</span>
</code></pre></div></div>

<p>Let’s take a closer look at an element of the <code class="highlighter-rouge">user</code> column.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">users</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'user'</span><span class="p">]</span>
</code></pre></div></div>

<p>In each row, the <code class="highlighter-rouge">user</code> column contains another dictionary with information about the user who posted the tweet. We can access the user’s location using the <code class="highlighter-rouge">location</code> key.</p>

<p>The strategy that we are going to use to extract the locations from each user will be to iterate through the rows of <code class="highlighter-rouge">users</code>; at each row we will add the tweet id and the user location to a new dictionary. This dictionary will then be added to a list. Once we have iterated through all of the rows of <code class="highlighter-rouge">users</code>, we will convert our final list of dictionaries into a <code class="highlighter-rouge">DataFrame</code>.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create an empty list.</span>
<span class="n">locations_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)):</span>
    <span class="c"># Create an empty dictionary.</span>
    <span class="n">new_entry</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># Copy the tweet id into the new dictionary.</span>
    <span class="n">new_entry</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'id'</span><span class="p">]</span>
    <span class="c"># Create a new key ('location') and assign it to the location of the user who</span>
    <span class="c"># wrote that tweet.</span>
    <span class="n">new_entry</span><span class="p">[</span><span class="s">'location'</span><span class="p">]</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'user'</span><span class="p">][</span><span class="s">'location'</span><span class="p">]</span>
    <span class="c"># Append the dictionary as another element of our list.</span>
    <span class="n">locations_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_entry</span><span class="p">)</span>
    
<span class="c"># Transform our list into a DataFrame. As before, each element of the list becomes</span>
<span class="c"># a row in the DataFrame, and each key becomes a column.</span>
<span class="n">all_locations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">locations_list</span><span class="p">)</span>

<span class="c"># Display the first 10 tweets.</span>
<span class="n">all_locations</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<p>Clearly this isn’t a foolproof method, since the location associated with an account may have little bearing on the actual location from which a tweet was posted. Also, not all users have a specific location connected to their account. Depending on the data you have pulled from Twitter, you may also notice that some of the “locations” are not actually real places. We can do a bit of data cleaning to filter out the rows that contain true locations. First, let’s get rid of the rows that do not contain any text at all in the <code class="highlighter-rouge">location</code> column.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create an empty DataFrame with the columns 'location' and 'id'</span>
<span class="n">no_empties</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'location'</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_locations</span><span class="p">)):</span>
    <span class="c"># This filters out tweets whose location column is an empty string.</span>
    <span class="k">if</span> <span class="n">all_locations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">"location"</span><span class="p">]</span> <span class="o">!=</span> <span class="s">''</span><span class="p">:</span>
        <span class="n">no_empties</span> <span class="o">=</span> <span class="n">no_empties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_locations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
<span class="n">no_empties</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<p>This looks pretty good! We would still like to filter through our locations for places that actually exist. Let’s use the <code class="highlighter-rouge">.groupby()</code> method to take a look at what locations we have in our data.</p>

<p>The <code class="highlighter-rouge">.groupby()</code> method takes in a table, a column, and optionally, an aggregate function (the default is count() which counts how many rows have the same value for the column we are grouping by. Other options include sum() and max() or min()). Groupby goes through each row, looks at the column that has been given to it of the current row, and groups each row based on if they have the same value at given column. After it has a list of rows for each distinct column value, it applies the aggregate function for each list, and returns a table of each distinct column value with the aggregate function applied to the rows that corresponded with the column.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">no_empties</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'location'</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</code></pre></div></div>

<p>If you scroll through this list, you will likely see a whole litany of “locations” that do not resemble locations since the user is allowed to write whatever they like as their location. We do not have time to day to sort through all of these right now, so we are goign to move on to a few other techniques that we can use to analyze these kinds of data.</p>

<h2 id="scraping-tweets-by-location">Scraping Tweets by Location</h2>
<hr />
<p>Since many of the tweets we scraped earlier do not have useful locations, we may want to filter by location when we ask the API for tweets. We can use the same function as before, using the optional <code class="highlighter-rouge">location</code> argument. The format of the location argument is <code class="highlighter-rouge">"latitude,longitude,radius"</code>. The following code searches for tweets hashtagged “gentrification” within a 5 km radius of the Temescal Oakland area.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gentrification_oak</span> <span class="o">=</span> <span class="n">download_recent_tweets_by_hashtag</span><span class="p">(</span><span class="n">hashtag</span> <span class="o">=</span> <span class="s">"gentrification"</span><span class="p">,</span>
                                                       <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">,</span>
                                                       <span class="n">location</span> <span class="o">=</span> <span class="s">"37.829314,-122.264433,5km"</span><span class="p">,</span>
                                                       <span class="n">count</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div></div>

<p>If you are running into errors downloading these tweets, uncomment and run the following cell to load in tweets that we scraped earlier.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># gentrification_oak = load_tweets('gentrification_oak.json')</span>
</code></pre></div></div>

<p><strong>Your turn:</strong> Let’s use the procedure we went through earlier to find the most common user location in the <code class="highlighter-rouge">gentrification_oak</code> tweets. We’ve provided some starter code, but you need to fill in wherever you see a <code class="highlighter-rouge">...</code>!</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">users_oak</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">gentrification_oak</span><span class="p">)</span>
<span class="n">users_oak</span> <span class="o">=</span> <span class="o">...</span> <span class="c"># select columns of interest</span>

<span class="n">locations_list_oak</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">users_oak</span><span class="p">)):</span>
    <span class="n">new_entry</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">new_entry</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">users_oak</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'id'</span><span class="p">]</span>
    <span class="n">new_entry</span><span class="p">[</span><span class="s">'location'</span><span class="p">]</span> <span class="o">=</span> <span class="n">users_oak</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'user'</span><span class="p">][</span><span class="s">'location'</span><span class="p">]</span>
    <span class="n">locations_list_oak</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c"># we want to add the new entry to our list</span>
<span class="n">all_locations_oak</span> <span class="o">=</span> <span class="o">...</span> <span class="c"># turn the list into a DataFrame</span>

<span class="n">no_empties_oak</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'location'</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_locations_oak</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">all_locations_oak</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">"location"</span><span class="p">]</span> <span class="o">!=</span> <span class="s">''</span><span class="p">:</span>
        <span class="n">no_empties_oak</span> <span class="o">=</span> <span class="n">no_empties_oak</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_locations_oak</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
        
<span class="n">grouped_locations</span> <span class="o">=</span> <span class="o">...</span>

<span class="c"># This finds the number of repeats of the most common location.</span>
<span class="n">max_number_of_tweets</span> <span class="o">=</span> <span class="n">grouped_locations</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span>

<span class="n">most_common_location</span> <span class="o">=</span> <span class="n">grouped_locations</span><span class="p">[</span><span class="n">grouped_locations</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_number_of_tweets</span><span class="p">]</span>

<span class="c"># most_common_location is a DataFrame with one item. This access all of the indices in the</span>
<span class="c"># DataFrame, then takes the first (and only) one.</span>
<span class="n">most_common_location</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="temporal-data">Temporal Data</h2>
<hr />
<p>Another facet of the tweets that you may want to analyze is the time at which they were posted. Currently, the only way we have information about the time the tweets were posted is in the <code class="highlighter-rouge">'created_at'</code> column, which is a string. As you may remember from the Introductory lab, <code class="highlighter-rouge">python</code> compares strings by assigning values to the letters themselves based on their position in the alphabet. We want to convert these strings to <code class="highlighter-rouge">datetime</code> objects, which will tell <code class="highlighter-rouge">python</code> at what time tweets were posted.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">post_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">gentrification_oak</span><span class="p">)[[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'created_at'</span><span class="p">]]</span>
<span class="n">post_time</span><span class="p">[</span><span class="s">'time'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">post_time</span><span class="p">[</span><span class="s">'created_at'</span><span class="p">])</span>
<span class="n">post_time</span><span class="p">[</span><span class="s">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Now that each string has been converted into a <code class="highlighter-rouge">datetime</code> object, we can extract the day, hour, minute, etc. of each time point like so</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">post_time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">day</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">post_time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">hour</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">post_time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">minute</span>
</code></pre></div></div>

<p>Notice that we are not adding parentheses at the end of each line. That is because the <code class="highlighter-rouge">.day</code>, <code class="highlighter-rouge">.hour</code>, and <code class="highlighter-rouge">.minute</code> are not <em>functions</em> we are calling, but rather <em>attributes</em> of the particular <code class="highlighter-rouge">datetime</code> object. If we want to look at the time of day that people tend to tweet about #gentrification, we can extract these attributes.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">post_time</span><span class="p">[</span><span class="s">'hour'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">post_time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">post_time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">minute</span><span class="o">/</span><span class="mi">60</span> <span class="o">+</span>
                     <span class="n">post_time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">second</span><span class="o">/</span><span class="mi">3600</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post_time</span><span class="p">))]</span>
<span class="n">post_time</span><span class="p">[</span><span class="s">'hour'</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Hour (UTC)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Number of Tweets"</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>Question:</strong> What observations or trends do you notice about this graph?</p>

<p><strong>Question:</strong> What could be improved about this graph or the process we used to obtain the data that generated it?</p>

<h2 id="sentiment-analysis">Sentiment Analysis</h2>
<hr />
<p>We can use the words the tweets to measure the sentiment, or the positive/negative feeling generated by the tweet. To do so we will be using the <a href="https://github.com/cjhutto/vaderSentiment">VADER (Valence Aware Dictionary and sEntiment Reasoner)</a>, which is a rule-based sentiment analysis tool specifically designed for social media. It even includes emojis! Run the following cell to load in the lexicon.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vader</span> <span class="o">=</span> <span class="n">load_vader</span><span class="p">()</span>
<span class="n">vader</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">500</span><span class="p">:</span><span class="mi">510</span><span class="p">,</span> <span class="p">:]</span>
</code></pre></div></div>

<p>The more positive the polarity of a word, the more positive feeling the word evokes in the reader. All of the words in <code class="highlighter-rouge">vader</code> are all lowercase, while many of our tweets are not. We need to modify the text in the tweets so that the words in our tweets will match up with the words stored in <code class="highlighter-rouge">vader</code>. Additionally, we need to remove punctuation since that will cause the words to not match up as well. We will put these modified tweets into another column in our <code class="highlighter-rouge">DataFrame</code> so that we can still have access to them later.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Select our columns of interest</span>
<span class="n">tweets_and_retweets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">gentrification_oak</span><span class="p">)[[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">,</span> <span class="s">'retweet_count'</span><span class="p">]]</span>

<span class="c"># Set the index of the DataFrame to the tweet ID. This step is necessary</span>
<span class="c"># in order to use our utility functions.</span>
<span class="n">tweets_and_retweets</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

<span class="c"># Remove punctuation and lowercase tweets</span>
<span class="n">tweets_and_retweets</span><span class="p">[</span><span class="s">'cleaned'</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_tweets</span><span class="p">(</span><span class="n">tweets_and_retweets</span><span class="p">[</span><span class="s">'text'</span><span class="p">])</span>

<span class="n">tweets_and_retweets</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Next, we want to merge our sentiment lexicon with our cleaned tweets.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tweets_and_retweets</span><span class="p">[</span><span class="s">'polarity'</span><span class="p">]</span> <span class="o">=</span> <span class="n">compose_polarity</span><span class="p">(</span><span class="n">tweets_and_retweets</span><span class="p">,</span> <span class="n">vader</span><span class="p">)</span>
<span class="n">tweets_and_retweets</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Next, we want to see if more polarizing tweets are retweeted more often. To do this, we can plot the <code class="highlighter-rouge">polarity</code> and <code class="highlighter-rouge">retweet_count</code> columns against each other.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tweets_and_retweets</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s">'polarity'</span><span class="p">,</span> <span class="s">'retweet_count'</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">'scatter'</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>Question:</strong> What conclusions can you draw about polarity and retweets from this graph? How does this compare with your assumptions?</p>

<h2 id="your-turn">Your turn!</h2>
<hr />
<p>If time allows, try these exercises on your own or as a class!</p>

<p><strong>Exercise 1:</strong> Using the <code class="highlighter-rouge">gentrification_oak</code> tweets, make a histogram of the time of day the tweets were posted. Note that if you would like the x-axis of the plot to reflect the correct time of day, you will have to convert the time from UTC to PDT.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># YOUR CODE HERE</span>
</code></pre></div></div>

<p><strong>Exercise 2:</strong> Try scraping tweets from multiple locations and the same hashtag. Make a histogram for each location and see if there are any differences in the distribution of polarity of the tweets. Feel free to use multiple cells to avoid querying the API repeatedly.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># YOUR CODE HERE</span>
</code></pre></div></div>

<h3 id="authors-monica-wilkinson-and-vera-wang">Authors: Monica Wilkinson and Vera Wang</h3>

              <nav class="c-page__nav">
  
    
    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/modules-textbook/cp-101/lab07/lab07.html">
      〈 <span class="u-margin-right-tiny"></span> Lab 7
    </a>
  

  
    
    <a id="js-page__nav__next" class="c-page__nav__next" href="/modules-textbook/cp-101/lab09/lab09.html">
      Lab 9 <span class="u-margin-right-tiny"></span> 〉
    </a>
  
</nav>

            </div>
          </div>
        </div>
      </main>
    </div>

  </body>
</html>

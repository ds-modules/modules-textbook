<!DOCTYPE html>
<html lang="en">
  

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>Lab 10</title>
  <meta name="description" content="# Libraries that this notebook will use:import numpy as npimport pandas as pdimport matplotlib.pyplot as pltimport geopandas as gpdfrom shapely.geometry impo...">

  <link rel="canonical" href="http://0.0.0.0:4000/modules-textbook/cp-101/lab10/lab10.html">
  <link rel="alternate" type="application/rss+xml" title="UC Berkeley Data Science Modules" href="http://0.0.0.0:4000/modules-textbook/feed.xml">

  <meta property="og:url"         content="http://0.0.0.0:4000/modules-textbook/cp-101/lab10/lab10.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Lab 10" />
<meta property="og:description" content="# Libraries that this notebook will use:import numpy as npimport pandas as pdimport matplotlib.pyplot as pltimport geopandas as gpdfrom shapely.geometry impo..." />
<meta property="og:image"       content="" />


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage":
    "http://0.0.0.0:4000/modules-textbook/cp-101/lab10/lab10.html",
  "headline":
    "Lab 10",
  "datePublished":
    "2019-05-29T21:30:50-05:00",
  "dateModified":
    "2019-05-29T21:30:50-05:00",
  "description":
    "# Libraries that this notebook will use:import numpy as npimport pandas as pdimport matplotlib.pyplot as pltimport geopandas as gpdfrom shapely.geometry impo...",
  "author": {
    "@type": "Person",
    "name": "Alex Nakagawa"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "http://0.0.0.0:4000/modules-textbook",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "http://0.0.0.0:4000/modules-textbook",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/modules-textbook/assets/css/styles.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css ">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/modules-textbook/images/logo/favicon.ico">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    CommonHTML: {
        linebreaks: {
            automatic: true,
        },
    },
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML' async></script>

  <!-- DOM updating function -->
  <script>
const runWhenDOMLoaded = cb => {
  if (document.readyState != 'loading') {
    cb()
  } else if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', cb)
  } else {
    document.attachEvent('onreadystatechange', function() {
      if (document.readyState == 'complete') cb()
    })
  }
}

// Helper function to init things quickly
initFunction = function(myfunc) {
  runWhenDOMLoaded(myfunc);
  document.addEventListener('turbolinks:load', myfunc);
};
</script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '/modules-textbook';
  </script>

  <!-- Add AnchorJS to let headers be linked -->
  <script src="/modules-textbook/assets/js/anchor.min.js"  type="text/javascript"></script>
  <script>

initFunction(function () {
    anchors.add("main h1, main h2, main h3, main h4")
});

</script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="/modules-textbook/assets/js/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  <script src="https://unpkg.com/nbinteract-core" async></script>

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->

<script type="text/x-thebe-config">
    {
      requestKernel: true,
      binderOptions: {
        repo: 'ds-modules/featured-modules',
        ref: 'master',
      },
      kernelOptions: {
        name: 'python3',
      }
    }
</script>
<script src="https://unpkg.com/thebelab@0.3.3/lib/index.js"></script>
<script>
    /**
     * Add attributes to Thebelab blocks
     */

    const initThebelab = () => {
        const addThebelabToCodeCells = () => {
            console.log("Adding thebelab to code cells...");
            // If Thebelab hasn't loaded, wait a bit and try again. This
            // happens because we load ClipboardJS asynchronously.
            if (window.thebelab === undefined) {
                setTimeout(addThebelabToCodeCells, 250)
            return
            }

            // If we already detect a Thebelab cell, don't re-run
            if (document.querySelectorAll('div.thebelab-cell').length > 0) {
                return;
            }

            // Find all code cells, replace with Thebelab interactive code cells
            const codeCells = document.querySelectorAll('.input_area pre')
            codeCells.forEach((codeCell, index) => {
                const id = codeCellId(index)
                codeCell.setAttribute('data-executable', 'true')

                // Figure out the language it uses and add this too
                var parentDiv = codeCell.parentElement.parentElement;
                var arrayLength = parentDiv.classList.length;
                for (var ii = 0; ii < arrayLength; ii++) {
                    var parts = parentDiv.classList[ii].split('language-');
                    if (parts.length === 2) {
                        // If found, assign dataLanguage and break the loop
                        var dataLanguage = parts[1];
                        break;
                    }
                }
                codeCell.setAttribute('data-language', dataLanguage)

                // If the code cell is hidden, show it
                var inputCheckbox = document.querySelector(`input#hidebtn${codeCell.id}`);
                if (inputCheckbox !== null) {
                    setCodeCellVisibility(inputCheckbox, 'visible');
                }
            });

            // Remove the event listener from the page so keyboard press doesn't
            // Change page
            document.removeEventListener('keydown', initPageNav)
            keyboardListener = false;

            // Init thebelab
            thebelab.bootstrap();

            // Remove copy buttons since they won't work anymore
            const copyButtons = document.querySelectorAll('.copybtn')
            copyButtons.forEach((copyButton, index) => {
                copyButton.remove();
            });

            // Remove outputs since they'll be stale
            const outputs = document.querySelectorAll('.output *, .output')
            outputs.forEach((output, index) => {
                output.remove();
            });
        }

        // Add event listener for the function to modify code cells
        const thebelabButton = document.getElementById('interact-button-thebelab');
        if (thebelabButton === null) {
            setTimeout(initThebelab, 250)
        return
        };
        thebelabButton.addEventListener('click', addThebelabToCodeCells);
    }

    // Initialize Thebelab
    initFunction(initThebelab);
</script>


  <!-- Google analytics -->
  <script src="/modules-textbook/assets/js/ga.js" async></script>

  <!-- Clipboard copy button -->
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" async></script>

  <!-- Load JS that depends on site variables -->
  <script>
/**
 * Set up copy/paste for code blocks
 */
const codeCellId = index => `codecell${index}`

const clipboardButton = id =>
  `<a class="btn copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#${id}">
    <img src="/modules-textbook/assets/images/copy-button.svg" alt="Copy to clipboard">
  </a>`

// Clears selected text since ClipboardJS will select the text when copying
const clearSelection = () => {
  if (window.getSelection) {
    window.getSelection().removeAllRanges()
  } else if (document.selection) {
    document.selection.empty()
  }
}

// Changes tooltip text for two seconds, then changes it back
const temporarilyChangeTooltip = (el, newText) => {
  const oldText = el.getAttribute('data-tooltip')
  el.setAttribute('data-tooltip', newText)
  setTimeout(() => el.setAttribute('data-tooltip', oldText), 2000)
}

const addCopyButtonToCodeCells = () => {
  // If ClipboardJS hasn't loaded, wait a bit and try again. This
  // happens because we load ClipboardJS asynchronously.
  if (window.ClipboardJS === undefined) {
    setTimeout(addCopyButtonToCodeCells, 250)
    return
  }

  const codeCells = document.querySelectorAll('div.highlighter-rouge:not(.output) pre')
  codeCells.forEach((codeCell, index) => {
    const id = codeCellId(index)
    codeCell.setAttribute('id', id)
    if (document.querySelector(`pre#${id} + a`) == null) {
      codeCell.insertAdjacentHTML('afterend', clipboardButton(id));
    }
  })

  const clipboard = new ClipboardJS('.copybtn')
  clipboard.on('success', event => {
    clearSelection()
    temporarilyChangeTooltip(event.trigger, 'Copied!')
  })

  clipboard.on('error', event => {
    temporarilyChangeTooltip(event.trigger, 'Failed to copy')
  })

  // Get rid of clipboard before the next page visit to avoid memory leak
  document.addEventListener('turbolinks:before-visit', () =>
    clipboard.destroy()
  )
}

initFunction(addCopyButtonToCodeCells);
</script>

  <!-- Hide cell code -->
  
<script>
/**
Add buttons to hide code cells
*/


var setCodeCellVisibility = function(inputField, kind) {
    // Update the image and class for hidden
    var id = inputField.getAttribute('data-id');
    var codeCell = document.querySelector(`#${id}`);

    if (kind === "visible") {
        codeCell.classList.remove('hidden');
        inputField.checked = true;
    } else {
        codeCell.classList.add('hidden');
        inputField.checked = false;
    }
}

var toggleCodeCellVisibility = function (event) {
    // The label is clicked, and now we decide what to do based on the input field's clicked status
    if (event.target.tagName === "LABEL") {
        var inputField = event.target.previousElementSibling;
    } else {
        // It is the span inside the target
        var inputField = event.target.parentElement.previousElementSibling;
    }

    if (inputField.checked === true) {
        setCodeCellVisibility(inputField, "visible");
    } else {
        setCodeCellVisibility(inputField, "hidden");
    }
}


// Button constructor
const hideCodeButton = id => `<input class="hidebtn" type="checkbox" id="hidebtn${id}" data-id="${id}"><label title="Toggle cell" for="hidebtn${id}" class="plusminus"><span class="pm_h"></span><span class="pm_v"></span></label>`

var addHideButton = function () {
  // If a hide button is already added, don't add another
  if (document.querySelector('div.hidecode input') !== null) {
      return;
  }

  // Find the input cells and add a hide button
  document.querySelectorAll('div.input_area div.highlight').forEach(function (item, index) {
    if (!item.parentElement.classList.contains("hidecode")) {
        // Skip the cell if it doesn't have a hidecode class
        return;
    }

    const id = codeCellId(index)
    item.setAttribute('id', id);
    item.insertAdjacentHTML('afterend', hideCodeButton(id))

    // Set up the visibility toggle
    hideLink = document.querySelector(`#${id} + input + label`);
    hideLink.addEventListener('click', toggleCodeCellVisibility)
  });
}


// Initialize the hide buttos
var initHiddenCells = function () {
    // Add hide buttons to the cells
    addHideButton();

    // Toggle the code cells that should be hidden
    document.querySelectorAll('div.hidecode input').forEach(function (item) {
        setCodeCellVisibility(item, 'hidden');
        item.checked = true;
    })
}

initFunction(initHiddenCells);

</script>


  <!-- Load custom website scripts -->
  <script src="/modules-textbook/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/modules-textbook/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/modules-textbook/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  
<script>
/**
  * To auto-embed hub URLs in interact links if given in a RESTful fashion
 */

function getJsonFromUrl(url) {
  var query = url.split('?');
  if (query.length < 2) {
    // No queries so just return false
    return false;
  }
  query = query[1];
  // Collect REST params into a dictionary
  var result = {};
  query.split("&").forEach(function(part) {
    var item = part.split("=");
    result[item[0]] = decodeURIComponent(item[1]);
  });
  return result;
}
    
function dict2param(dict) {
    params = Object.keys(dict).map(function(k) {
        return encodeURIComponent(k) + '=' + encodeURIComponent(dict[k])
    });
    return params.join('&')
}

// Parse a Binder URL, converting it to the string needed for JupyterHub
function binder2Jupyterhub(url) {
  newUrl = {};
  parts = url.split('v2/gh/')[1];
  // Grab the base repo information
  repoinfo = parts.split('?')[0];
  var [org, repo, ref] = repoinfo.split('/');
  newUrl['repo'] = ['https://github.com', org, repo].join('/');
  newUrl['branch'] = ref
  // Grab extra parameters passed
  params = getJsonFromUrl(url);
  if (params['filepath'] !== undefined) {
    newUrl['subPath'] = params['filepath']
  }
  return dict2param(newUrl);
}

// Filter out potentially unsafe characters to prevent xss
function safeUrl(url)
{
   return String(encodeURIComponent(url))
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
}

function addParamToInternalLinks(hub) {
  var links = document.querySelectorAll("a").forEach(function(link) {
    var href = link.href;
    // If the link is an internal link...
    if (href.search("http://0.0.0.0:4000") !== -1 || href.startsWith('/') || href.search("127.0.0.1:") !== -1) {
      // Assume we're an internal link, add the hub param to it
      var params = getJsonFromUrl(href);
      if (params !== false) {
        // We have REST params, so append a new one
        params['jupyterhub'] = hub;
      } else {
        // Create the REST params
        params = {'jupyterhub': hub};
      }
      // Update the link
      var newHref = href.split('?')[0] + '?' + dict2param(params);
      link.setAttribute('href', decodeURIComponent(newHref));
    }
  });
  return false;
}


// Update interact links
function updateInteractLink() {
    // hack to make this work since it expects a ? in the URL
    rest = getJsonFromUrl("?" + location.search.substr(1));
    jupyterHubUrl = rest['jupyterhub'];
    var hubType = null;
    var hubUrl = null;
    if (jupyterHubUrl !== undefined) {
      hubType = 'jupyterhub';
      hubUrl = jupyterHubUrl;
    }

    if (hubType !== null) {
      // Sanitize the hubUrl
      hubUrl = safeUrl(hubUrl);

      // Add HTTP text if omitted
      if (hubUrl.indexOf('http') < 0) {hubUrl = 'http://' + hubUrl;}
      var interactButtons = document.querySelectorAll("button.interact-button")
      var lastButton = interactButtons[interactButtons.length-1];
      var link = lastButton.parentElement;

      // If we've already run this, skip the link updating
      if (link.nextElementSibling !== null) {
        return;
      }

      // Update the link and add context div
      var href = link.getAttribute('href');
      if (lastButton.id === 'interact-button-binder') {
        // If binder links exist, we need to re-work them for jupyterhub
        if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
          // If localhost, assume we're working from a local Jupyter server and remove `/hub`
          first = [hubUrl, 'git-sync'].join('/')
        } else {
          first = [hubUrl, 'hub', 'user-redirect', 'git-sync'].join('/')
        }
        href = first + '?' + binder2Jupyterhub(href);
      } else {
        // If interact button isn't binderhub, assume it's jupyterhub
        // If JupyterHub links, we only need to replace the hub url
        href = href.replace("https://datahub.berkeley.edu", hubUrl);
        if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
          // Assume we're working from a local Jupyter server and remove `/hub`
          href = href.replace("/hub/user-redirect", "");
        }
      }
      link.setAttribute('href', decodeURIComponent(href));

      // Add text after interact link saying where we're launching
      hubUrlNoHttp = decodeURIComponent(hubUrl).replace('http://', '').replace('https://', '');
      link.insertAdjacentHTML('afterend', '<div class="interact-context">on ' + hubUrlNoHttp + '</div>');

      // Update internal links so we retain the hub url
      addParamToInternalLinks(hubUrl);
    }
}

runWhenDOMLoaded(updateInteractLink)
document.addEventListener('turbolinks:load', updateInteractLink)
</script>


  <!-- Lunr search code - will only be executed on the /search page -->
  <script src="/modules-textbook/assets/js/lunr/lunr.min.js" type="text/javascript"></script>
  <script>var initQuery = function() {
  // See if we have a search box
  var searchInput = document.querySelector('input#lunr_search');
  if (searchInput === null) {
    return;
  }

  // Function to parse our lunr cache
  var idx = lunr(function () {
    this.field('title')
    this.field('excerpt')
    this.field('categories')
    this.field('tags')
    this.ref('id')

    this.pipeline.remove(lunr.trimmer)

    for (var item in store) {
      this.add({
        title: store[item].title,
        excerpt: store[item].excerpt,
        categories: store[item].categories,
        tags: store[item].tags,
        id: item
      })
    }
  });

  // Run search upon keyup
  searchInput.addEventListener('keyup', function () {
    var resultdiv = document.querySelector('#results');
    var query = document.querySelector("input#lunr_search").value.toLowerCase();
    var result =
      idx.query(function (q) {
        query.split(lunr.tokenizer.separator).forEach(function (term) {
          q.term(term, { boost: 100 })
          if(query.lastIndexOf(" ") != query.length-1){
            q.term(term, {  usePipeline: false, wildcard: lunr.Query.wildcard.TRAILING, boost: 10 })
          }
          if (term != ""){
            q.term(term, {  usePipeline: false, editDistance: 1, boost: 1 })
          }
        })
      });

      // Empty the results div
      while (resultdiv.firstChild) {
        resultdiv.removeChild(resultdiv.firstChild);
      }

    resultdiv.insertAdjacentHTML('afterbegin', '<p class="results__found">'+result.length+' Result(s) found</p>');
    for (var item in result) {
      var ref = result[item].ref;
      if(store[ref].teaser){
        var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<div class="archive__item-teaser">'+
                '<img src="'+store[ref].teaser+'" alt="">'+
              '</div>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      else{
    	  var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      resultdiv.insertAdjacentHTML('beforeend', searchitem);
    }
  });
};

initFunction(initQuery);
</script>
</head>

  <body>
    <!-- .js-show-sidebar shows sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      



<nav id="js-sidebar" class="c-textbook__sidebar">
  <a href="https://ds-modules.github.io/modules-textbook"><img src="/modules-textbook/images/logo/logo.png" class="textbook_logo" id="sidebar-logo" data-turbolinks-permanent/></a>
  <h2 class="c-sidebar__title">UC Berkeley Data Science Modules</h2>
  <ul class="c-sidebar__chapters">
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/intro.html"
        >
          
          Home
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="https://github.com/ds-modules/"
        >
          
          DSEP Modules Repository
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="https://berkeley-data.gitbook.io/curriculum-guide/introduction/readme"
        >
          
          Data Science Curriculum Guide
        </a>

        
      </li>

      
    
      
      
        <li class="c-sidebar__chapter"><a class="c-sidebar__entry" href="/modules-textbook/search.html">Search</a></li>
        
      
      
        <li class="c-sidebar__divider"></li>
        
      
      
        <li><h2 class="c-sidebar__title">Introduction</li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/introduction/ds-intro.html"
        >
          
          Data Science in Python and Jupyter
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/introduction/intro-module-final.html"
                >
                  
                  Intro to Python and Jupyter
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/features/notebooks.html"
                >
                  
                  Jupyter notebooks
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      
        <li><h2 class="c-sidebar__title">Modules</li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/cp-101/cp-101-intro.html"
        >
          
          City Planning
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/cp-101/lab07/lab07.html"
                >
                  
                  Lab 7
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/cp-101/lab08/lab08.html"
                >
                  
                  Lab 8
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/cp-101/lab09/lab09.html"
                >
                  
                  Lab 9
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry c-sidebar__entry--active"
                  href="/modules-textbook/cp-101/lab10/lab10.html"
                >
                  
                  Lab 10
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/xenglish-r1a/xenglish-r1a-intro.html"
        >
          
          English
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/xenglish-r1a/01-Chinatowns.html"
                >
                  
                  Chinatows
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/legalst-190/legalst-190-intro.html"
        >
          
          Legal Studies
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/legalst-190/1-18.html"
                >
                  
                  Intro to Python
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/legalst-190/ps1/SF_Crime_PSET1.html"
                >
                  
                  Problem Set 1
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/modules-textbook/psych-167ac/psych-167ac-intro.html"
        >
          
          Psychology
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/psych-167ac/01-intro.html"
                >
                  
                  Introduction
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/psych-167ac/02-correlation-regression.html"
                >
                  
                  Correlation & Regression
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/modules-textbook/psych-167ac/03-my-project.html"
                >
                  
                  My Project
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
  </ul>
  <p class="sidebar_footer">Powered by <a href="https://github.com/jupyter/jupyter-book">Jupyter Book</a></p>
</nav>

      
      <!-- Shamelessly copied from minimal mistakes -->


<!-- TOC will only show up if it has at least one item -->


  <aside class="sidebar__right">
    <nav class="onthispage">
      <header><h4 class="nav__title"><i class="fa fa-list"></i>   On this page</h4></header>
      <ul class="toc__menu">
  <li><a href="#data-cleaning">Data cleaning</a></li>
  <li><a href="#plotting-the-number-of-tweets-over-time">Plotting the number of tweets over time</a>
    <ul>
      <li><a href="#converting-to-datetime">Converting to DateTime</a></li>
      <li><a href="#grouping-tweets-by-date">Grouping tweets by date</a></li>
      <li><a href="#using-matplotlib-to-plot-a-line-plot-number-of-tweets-vs-date">Using Matplotlib to plot a line plot: Number of tweets vs. date</a></li>
    </ul>
  </li>
  <li><a href="#number-of-tweets-by-tract---barplots">Number of tweets by tract - Barplots</a>
    <ul>
      <li><a href="#grouping-tweets-by-census-tract">Grouping tweets by census tract</a></li>
      <li><a href="#sorting-tweet-counts-in-descending-order">Sorting tweet counts in descending order</a></li>
      <li><a href="#convert-census-tract-numbers-to-strings">Convert census tract numbers to strings</a></li>
    </ul>
  </li>
  <li><a href="#moving-on-to-geopandas-visualizing-number-of-tweets-per-census-tract-spatially">Moving on to GeoPandas: Visualizing number of tweets per census tract spatially</a>
    <ul>
      <li><a href="#merging-dataframes">Merging dataframes</a></li>
    </ul>
  </li>
  <li><a href="#feedback-form">Feedback form</a></li>
  <li><a href="#resources">Resources</a>
    <ul>
      <li><a href="#author-rebekah-tang">Author: Rebekah Tang</a></li>
      <li><a href="#references">References:</a></li>
    </ul>
  </li>
</ul>
    </nav>
  </aside>


      
      <main class="c-textbook__page" tabindex="-1">
          <div class="o-wrapper">
            <div class="c-sidebar-toggle">
  <!-- We show the sidebar by default so we use .is-active -->
  <button
    id="js-sidebar-toggle"
    class="hamburger hamburger--arrowalt is-active"
  >
    <span class="hamburger-box">
      <span class="hamburger-inner"></span>
    </span>
    <span class="c-sidebar-toggle__label">Toggle Sidebar</span>
  </button>
</div>

            
<div class="buttons">
<a href="/modules-textbook/content/cp-101/lab10/lab10.ipynb" download>
<button id="interact-button-download" class="interact-button">Download</button>
</a>

<button id="interact-button-thebelab" class="interact-button">Thebelab</button>








<a href="https://mybinder.org/v2/gh/ds-modules/featured-modules/master?filepath=content%2Fcp-101%2Flab10%2Flab10.ipynb"><button class="interact-button" id="interact-button-binder"><img class="interact-button-logo" src="/modules-textbook/assets/images/logo_binder.svg" alt="Interact" />Binder</button></a>






<a href="https://datahub.berkeley.edu/hub/user-redirect/git-pull?repo=https://github.com//ds-modules/featured-modules&amp;branch=master&amp;subPath=content%2Fcp-101%2Flab10%2Flab10.ipynb&amp;app=notebook"><button class="interact-button" id="interact-button-jupyterhub"><img class="interact-button-logo" src="/modules-textbook/assets/images/logo_jupyterhub.svg" alt="Interact" />DataHub</button></a>



</div>


            <div class="c-textbook__content">
              <div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Libraries that this notebook will use:</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="n">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="c"># Helps the maps display nicely in the notebook:</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="c"># Tells the notebook not to display warnings:</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">'ignore'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
</code></pre></div></div>

<h1 id="working-with-and-visualizing-large-datasets">Working with and visualizing large datasets</h1>
<ul>
  <li>Dealing with missing values</li>
  <li>Filtering and selecting for certain rows and columns with <code class="highlighter-rouge">.iloc[]</code> and <code class="highlighter-rouge">.loc[]</code></li>
  <li>Grouping data by specific attributes with <code class="highlighter-rouge">.groupby()</code></li>
  <li>Working with temporal and categorial data and plotting lineplots and barplots</li>
  <li>Reviewing list comprehensions</li>
  <li>Merging two dataframes with <code class="highlighter-rouge">.merge()</code></li>
  <li>Plotting chloropleth maps with GeoPandas</li>
</ul>

<h2 id="data-cleaning">Data cleaning</h2>

<p>Today we’re going to extend our Pandas and Geopandas knowledge to manipulate and visualize an existing large dataset. This dataset is a random sample of tweets collected over time (2012 to 2015) in Alameda County. The most relevant columns are the tweet ID, user ID, latitude, longitude, date, and census tract number.</p>

<p>First, we need to clean the data. This data is relatively clean, but some columns have missing values, which may be problematic when you’re trying to visualize, analyze, or model the data. There are many ways to deal with missing values, but today we’re going to go over one: simply getting rid of them.</p>

<p>Now, let’s read in the data (from a .csv file) into Pandas. We’ll call the variable for the dataframe <code class="highlighter-rouge">tweets</code>.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tweets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"tweets.csv"</span><span class="p">)</span>
<span class="n">tweets</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Let’s take a look of how many rows we have before deleting the rows with missing values.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">len</span><span class="p">(</span><span class="n">tweets</span><span class="p">)</span> <span class="c">##185793</span>
</code></pre></div></div>

<p>Let’s also look at what the column names of the dataset are.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tweets</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div></div>

<p>Before we clean, let’s view the rows with missing values first. The code below is how we can do so. Let’s break it down.</p>

<p><code class="highlighter-rouge">tweets.isnull().any(axis=1)</code> is a conditional statement that is a True or False value denoting if the corresponding row has a missing value.
<code class="highlighter-rouge">tweets[tweets.isnull().any(axis=1)]</code> selects the rows for where the above conditional is True.</p>

<p>Note: axis = 0 would select the columns.</p>

<p>Run the code below to display the first five rows that have missing values.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run this</span>
<span class="c"># Display rows with missing values in any column.</span>
<span class="n">tweets</span><span class="p">[</span><span class="n">tweets</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="nb">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>There should be a total of 26 rows with missing values in the dataset. Run the next cell with the len() function to confirm.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">len</span><span class="p">(</span><span class="n">tweets</span><span class="p">[</span><span class="n">tweets</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="nb">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span>
</code></pre></div></div>

<p>Now let’s actually delete the rows, using the function</p>

<p><code class="highlighter-rouge">dataframename.dropna(axis=0, how='any')</code></p>

<p>which drops any row where there is a missing value in any column. Use <code class="highlighter-rouge">dropna(...)</code> on the dataframe <code class="highlighter-rouge">tweets</code>. Use <code class="highlighter-rouge">len()</code> to count how many rows are remaining. You should see that the row count has dropped by 81.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ...</span>
<span class="n">tweets</span> <span class="o">=</span> <span class="o">...</span>
<span class="nb">len</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div></div>

<p>Run the following cell to display the rows with missing values. There should be none.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tweets</span><span class="p">[</span><span class="n">tweets</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="nb">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</code></pre></div></div>

<p>Run the following cell to reset the indices and get rid of extraneous columns. We will explain how this works in a later section.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tweets</span> <span class="o">=</span> <span class="n">tweets</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">tweets</span> <span class="o">=</span> <span class="n">tweets</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'u_id'</span><span class="p">,</span> <span class="s">'lat'</span><span class="p">,</span> <span class="s">'lon'</span><span class="p">,</span> <span class="s">'date'</span><span class="p">,</span> <span class="s">'tract'</span><span class="p">,</span> <span class="s">'home_tract'</span><span class="p">]]</span>
<span class="n">tweets</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="plotting-the-number-of-tweets-over-time">Plotting the number of tweets over time</h2>
<h3 id="converting-to-datetime">Converting to DateTime</h3>
<p>Notice that we have temporal data in the <code class="highlighter-rouge">tweets</code> dataset. We can use the temporal information to plot the number of tweets over time. However, right now the temporal information is so fine grain, right down towards the second, that we probably won’t be able to see any patterns. So for this exercise, <em>we only want the date information</em>.</p>

<p>Now let’s take a step backwards first.
In our dataframe, the temporal information is stored as <strong>strings</strong>, but for Python to understand these strings as temporal information, we’ll need to convert them to <strong>Python DateTime</strong> objects. From then we can get the dates only.</p>

<p>When we run the following code, we can see that the individual dates are currently stored as strings.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run this</span>
<span class="k">print</span><span class="p">(</span><span class="n">tweets</span><span class="p">[</span><span class="s">'date'</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tweets</span><span class="p">[</span><span class="s">'date'</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div></div>

<p>To convert them into DateTime objects, we simply need to use the</p>

<p><code class="highlighter-rouge">pd.to_datetime(&lt;the list, array, or series you want to convert&gt;)</code></p>

<p>function, which outputs the converted values. In the following cell, set the date column equal to the converted values you get with <code class="highlighter-rouge">pd._to_datetime(...)</code>. When you run <code class="highlighter-rouge">print()</code> lines, you should see that the type of the dates has now changed into “Timestamp”.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in ...</span>
<span class="n">tweets</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">print</span><span class="p">(</span><span class="n">tweets</span><span class="p">[</span><span class="s">'date'</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tweets</span><span class="p">[</span><span class="s">'date'</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div></div>

<p>Now, we want to get the date from a Timestamp, which is the first part of the output above. To do this, we will use a list comprehension.</p>

<p>To remind you, here’s the structure of a list comprehension. Let’s say you have a list called <code class="highlighter-rouge">nums</code> with values <code class="highlighter-rouge">[1, 2, 3]</code> and want to add 1 to each of the values. The variable n will take on every value in the list called nums, and then we add 1 to every value.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##If we wanted to do the above with a for loop, it would look like this:</span>

<span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">new_nums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
    <span class="n">add_1</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">new_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_1</span><span class="p">)</span>
    
<span class="n">new_nums</span>
</code></pre></div></div>

<p>A list comprehension runs faster than a for loop because we do everything in a single line, whereas in a for loop, we have to go through more than one line.</p>

<p>Now do the exercise below.</p>

<p>To only get the date from a Timestamp, you just need to use the function</p>

<p><code class="highlighter-rouge">&lt;the timestamp&gt;.date()</code>.</p>

<p>To convert all the values in our column, we can use a list comprehension. Set the date column equal to the output of your list comprehension.</p>

<p>When you run the <code class="highlighter-rouge">print()</code> lines, you can see that type of the dates has now changed to “datetime.date”.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in ...</span>
<span class="n">tweets</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">print</span><span class="p">(</span><span class="n">tweets</span><span class="p">[</span><span class="s">'date'</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tweets</span><span class="p">[</span><span class="s">'date'</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run this</span>
<span class="n">tweets</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="grouping-tweets-by-date">Grouping tweets by date</h3>
<p>Now we want to aggregate by date. Specifically, we want to get the count of tweets per date. We can use the function</p>

<p><code class="highlighter-rouge">&lt;the dataframe&gt;.groupby(by=&lt;column name to group by&gt;).&lt;an aggregating function, e.g. count(), max(), mean()&gt;</code>,</p>

<p>which outputs a grouped dataframe, to do so. Which aggregating function should we use? Set a variable called <code class="highlighter-rouge">tweets_by_date</code> equal to the grouped dataframe.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in ...</span>
<span class="n">tweets_by_date</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">tweets_by_date</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Below, we are going to perform some dataframe operations that will prepare our data for visualization. Pay attention, as you will need to do something similar later on.</p>

<p>Notice how the date column is now bolded. Pandas now views the date column as an index, which is like an address. However, we want it to be a normal column again if we want to access it with attributes like <code class="highlighter-rouge">loc</code> and <code class="highlighter-rouge">iloc</code>. We use <code class="highlighter-rouge">reset_index()</code> to reset the index.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run this</span>
<span class="n">tweets_by_date</span> <span class="o">=</span> <span class="n">tweets_by_date</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">tweets_by_date</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Now we have a lot of columns that we don’t need. Remember <code class="highlighter-rouge">.iloc[]</code>? We’ll use <code class="highlighter-rouge">.iloc[]</code> to select only the first two columns.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run this</span>
<span class="n">tweets_by_date</span> <span class="o">=</span> <span class="n">tweets_by_date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">tweets_by_date</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>The second column has a weird name. <code class="highlighter-rouge">tweets_by_date.columns</code> gets the column names of the dataframe. We can set them equal to a list with the new column names to rename them. Let’s run the cell below to rename the id column to number of tweets</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run this</span>
<span class="n">tweets_by_date</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'date'</span><span class="p">,</span> <span class="s">'number of tweets'</span><span class="p">]</span>
<span class="n">tweets_by_date</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="using-matplotlib-to-plot-a-line-plot-number-of-tweets-vs-date">Using Matplotlib to plot a line plot: Number of tweets vs. date</h3>
<p>Time to plot! Use</p>

<p><code class="highlighter-rouge">plt.plot(&lt;list, array, or series of the x values&gt;, &lt;the y values&gt;)</code></p>

<p>to plot the number of tweets vs. time. We’ve labeled the axes and title. Study the code, as you will need to do it yourself later.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ... with your plotting code</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="o">...</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'time'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'number of tweets'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Number of Tweets over Time'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="number-of-tweets-by-tract---barplots">Number of tweets by tract - Barplots</h2>
<h3 id="grouping-tweets-by-census-tract">Grouping tweets by census tract</h3>
<p>Remember how we grouped tweets by date? Do the same, but this time, group instead by <code class="highlighter-rouge">tract</code> and aggregate with count(). Set the output equal to a variable called <code class="highlighter-rouge">tweets_by_tract</code>.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ...</span>
<span class="n">tweets_by_tract</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">tweets_by_tract</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Pandas now sees the tract as an index, but we don’t want that. Set the indices back to normal using <code class="highlighter-rouge">reset_index()</code>, referencing the previous section.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ...</span>
<span class="n">tweets_by_tract</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">tweets_by_tract</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>We only want the tract number and counts. Use <code class="highlighter-rouge">.iloc[]</code> to select only the first two columns.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ...</span>
<span class="n">tweets_by_tract</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">tweets_by_tract</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Now we want to rename this <code class="highlighter-rouge">id</code> column to <code class="highlighter-rouge">number of tweets</code>. Can you recall from the previous section how to do that?</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ...</span>
<span class="n">tweets_by_tract</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">tweets_by_tract</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="sorting-tweet-counts-in-descending-order">Sorting tweet counts in descending order</h3>
<p>There are 360 tracts, which is too much to plot on one bar plot. Let’s graph the top 10 tracts with the most tweets.</p>

<p>First, let’s set <code class="highlighter-rouge">tweets_by_tract</code> to a sorted version of itself. Use the function:</p>

<p><code class="highlighter-rouge">&lt;the dataframe&gt;.sort_values(by=&lt;column name&gt;, ascending=False)</code></p>

<p>which outputs a sorted dataframe, to do so.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ...</span>
<span class="n">tweets_by_tract</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">tweets_by_tract</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Note: ascending = False makes it so that we sort the number of tweets in descending order. ascending = True will sort them in ascending order.</p>

<h3 id="convert-census-tract-numbers-to-strings">Convert census tract numbers to strings</h3>
<p>Currently, the census tracts are stored as integers. If you tried to plot with these, the barplot would not display correctly. Additionally, census tracts are not numerical data, but categorical data. So, instead we want to store each census tract as a <strong>string</strong>. We can use a list comprehension to do so!</p>

<p>Create a new column in <code class="highlighter-rouge">tweets_by_tract</code> named <code class="highlighter-rouge">GEOID</code> with these census tract strings.</p>

<p><em>Important Hint:</em>
Make sure that the strings are of a specific format.
The tract numbers are currently of the <strong>float</strong> type, which means they have decimal points (e.g. 10.0). We want them to be <strong>integers</strong> (e.g. 10) before we convert them into strings.</p>

<p>You can use <code class="highlighter-rouge">int()</code> to convert a float first to an integer. Then use <code class="highlighter-rouge">str()</code> to convert the integer into a string! To do both at once, use <code class="highlighter-rouge">str(int(...))</code>.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ...</span>
<span class="n">tweets_by_tract</span><span class="p">[</span><span class="s">'GEOID'</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">tweets_by_tract</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Now we want to plot the top 10 tracts with the highest counts. Use <code class="highlighter-rouge">.iloc[]</code>to select the top 10 GEOID’s and the top 10 tweet counts. Remember: columns have indices starting at 0! Which index are the GEOID and number of tweets columns in? After this, use</p>

<p><code class="highlighter-rouge">plt.bar(&lt;the list, array, or series of x values&gt;, &lt;the y values&gt;)</code></p>

<p>to plot a bar plot (note: if we want a horizontal bar plot, simply add an ‘h’ after bar. But for this, we will get vertical bars instead). Make sure to add a labels to the x and y axes, as well as the title. Refer to the previous section for how to do so.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ...</span>
<span class="n">top_10_tracts</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">top_10_tweetcounts</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="o">...</span>
</code></pre></div></div>

<h2 id="moving-on-to-geopandas-visualizing-number-of-tweets-per-census-tract-spatially">Moving on to GeoPandas: Visualizing number of tweets per census tract spatially</h2>
<p>The bar plot is fascinating, but we’re not any more enlightened than before, because most people don’t memorize census tract numbers. A better way would be to analyze the data spatially, which means using GeoPandas!</p>

<p>Read in the alameda data from the previous lab. This contains the Shapely geometry polygons that we’ll need to map our data.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">alameda</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s">'alameda_shapefiles'</span><span class="p">)</span>
<span class="n">alameda</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Let’s recall what the column names are for this dataset. Run the cell below.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">alameda</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div></div>

<p>We don’t need all of these columns. Use <code class="highlighter-rouge">.loc[]</code> to select only the columns named:
GEOID, female, male, medianage, total_pop, and geometry.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">alameda</span> <span class="o">=</span> <span class="n">alameda</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s">'GEOID'</span><span class="p">,</span> <span class="s">'female'</span><span class="p">,</span> <span class="s">'male'</span><span class="p">,</span> <span class="s">'medianage'</span><span class="p">,</span> <span class="s">'total_pop'</span><span class="p">,</span> <span class="s">'geometry'</span><span class="p">]]</span>
<span class="n">alameda</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="merging-dataframes">Merging dataframes</h3>
<p>Notice how the <code class="highlighter-rouge">alameda</code> dataset contains a variety of values by GEOID. Conveniently, so does our <code class="highlighter-rouge">tweets_per_tract</code> dataset! If we simply add the tweet counts to the alameda dataset, we would be able to plot a chloropleth map on the number of tweets per census tract.</p>

<p>To do so, we’re going to perform an operation called a <strong>merge</strong> or <strong>join</strong>. We’re going to perform the join on the <code class="highlighter-rouge">GEOID</code> column, so that the tweet count data corresponds correctly to the right census tract.</p>

<p>First, we need to fix a slight problem. The <code class="highlighter-rouge">alameda GEOID</code> column values have a 0 before, while the <code class="highlighter-rouge">tweets_by_tract GEOID</code> column values don’t. This is easy, we can just concatenate a ‘0’ in front of each census tract number in <code class="highlighter-rouge">tweets_by_tract</code> using a list comprehension.</p>

<p>Below is a quick review on how string concatenation works.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"pineapple"</span> <span class="o">+</span> <span class="s">"pen"</span>
</code></pre></div></div>

<p>Now, fill in the cell below with a list comprehension that append a ‘0’ in f ront of each GEOID.</p>

<p>Hint: recall the str(int()) trick from before.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ...</span>
<span class="n">tweets_by_tract</span><span class="p">[</span><span class="s">'GEOID'</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">tweets_by_tract</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Time to merge! Use the function</p>

<p><code class="highlighter-rouge">&lt;a dataframe&gt;.merge(&lt;another dataframe&gt;, on=&lt;column name to merge on&gt;)</code></p>

<p>and set the output equal to variable called <code class="highlighter-rouge">combined</code>.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in</span>
<span class="n">combined</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">combined</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>There are other types of merging techniques in python. By default, if we do not specify what type of merge we do, python will treat is as a <code class="highlighter-rouge">left</code> join, which means if will keep all the unique values for the table on the left of the .merge method. To learn more about other types of joins, see the link below:</p>

<p>https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.join.html</p>

<p>Recall the chloropleths we created in the last lab. Now create a chloropleth map of the number of tweets per census tract.</p>

<p>Reference:
<code class="highlighter-rouge">&lt;the geodataframe&gt;.plot(column=&lt;column name&gt;, legend=True, figsize=[18, 10])</code></p>

<p>Remember to add a title and remove the axes.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#fill in the ... with your code and replace the next line with combined.plot(...)</span>

<span class="c">##replace this line with combined.plot(...)</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">minx</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">miny</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">maxx</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">maxy</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">text_properties</span> <span class="o">=</span> <span class="p">{</span><span class="s">'ha'</span><span class="p">:</span> <span class="s">'center'</span><span class="p">,</span> <span class="s">'va'</span><span class="p">:</span> <span class="s">'center'</span><span class="p">,</span> <span class="s">'fontsize'</span> <span class="p">:</span> <span class="mi">20</span><span class="p">}</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">maxx</span> <span class="o">+</span> <span class="p">(</span><span class="n">maxx</span><span class="o">-</span><span class="n">minx</span><span class="p">)</span><span class="o">/</span><span class="mf">4.5</span><span class="p">,</span> <span class="p">(</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">miny</span><span class="p">,</span> <span class="s">'Percentage of Tweet Counts by Census Tract'</span><span class="p">,</span> <span class="n">text_properties</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="o">..</span><span class="p">);</span>
</code></pre></div></div>

<p>This looks so much better than the bar plot! But what if some census tracts only have a lot of tweets because they have a larger population size? Instead, we should plot number of tweets per capita.</p>

<p>Make a new column in <code class="highlighter-rouge">combined</code> called <code class="highlighter-rouge">avg tweets per capita</code>. Set it equal to <code class="highlighter-rouge">number of tweets</code> divided by <code class="highlighter-rouge">total_pop</code>. Then plot the new chloropleth map. Remember to add the title and remove the axes.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ... with your code</span>
<span class="n">combined</span><span class="p">[</span><span class="s">"avg tweets per capita"</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>

<span class="c">##Let's see what the table looks now with the new column:</span>
<span class="n">combined</span><span class="o">.</span><span class="n">head</span><span class="p">()</span> <span class="c">##scroll to the right if needed to see all the columns</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##fill in the ... with your code to plot</span>
<span class="n">combined</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">maxx</span> <span class="o">+</span> <span class="p">(</span><span class="n">maxx</span><span class="o">-</span><span class="n">minx</span><span class="p">)</span><span class="o">/</span><span class="mf">4.5</span><span class="p">,</span> <span class="p">(</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">miny</span><span class="p">,</span> <span class="s">'Percentage of Tweet Counts by Census Tract'</span><span class="p">,</span> <span class="n">text_properties</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
</code></pre></div></div>

<p>These are by no means the only visualizations you can create with the <code class="highlighter-rouge">combined</code> dataset. In the cell below, create your own visualization!</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Your own visualization here</span>
</code></pre></div></div>

<h2 id="feedback-form">Feedback form</h2>
<p>Thank you for exploring data science with us! We hope you have enjoyed the past four labs that the division of data science has created for you. It would be wonderful if you could leave us feedback here so that we can improve for the course in the future:</p>

<p>https://docs.google.com/forms/d/e/1FAIpQLSe54U3E64kYFWwQHSUpAvWYMuJOdKzbHDZjPa3nMUlHSSs0PQ/viewform</p>

<h2 id="resources">Resources</h2>
<p>If you’re interested in exploring more about data science, Berkeley’s <a href="https://www.inferentialthinking.com/chapters/intro.html">Data 8</a> and <a href="https://www.textbook.ds100.org/">Data 100</a> textbooks are very well-written with interactive links to follow along.</p>

<p>There are also websites like <a href="https://www.datacamp.com/courses">DataCamp</a> and <a href="https://www.dataquest.io/course/python-for-data-science-fundamentals/">DataQuest</a> that offer online interactive courses in R, Python, and SQL, many of them for free.</p>

<p>If you’re stuck trying to work on a project, <a href="https://data.berkeley.edu/education/data-peer-consulting">Data Peer Consulting</a> at the Division of Data Sciences could be helpful to you.</p>

<p>If you’re looking for more specialized help, the <a href="https://dlab.berkeley.edu/">D-lab</a> which focuses on data science applications to the social sciences specifically, holds <a href="https://dlab.berkeley.edu/training">workshops</a> and <a href="https://dlab.berkeley.edu/consulting">consulting</a>, many on geospatial data.</p>

<hr />
<h3 id="author-rebekah-tang">Author: Rebekah Tang</h3>

<h3 id="references">References:</h3>
<ul>
  <li>GeoPandas Mapping Documentation: http://geopandas.org/mapping.html</li>
  <li>Pandas Documentation: https://pandas.pydata.org/pandas-docs/stable/reference/frame.html</li>
  <li>Matplotlib Documentation: https://matplotlib.org/api/pyplot_summary.html</li>
</ul>

              <nav class="c-page__nav">
  
    
    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/modules-textbook/cp-101/lab09/lab09">
      〈 <span class="u-margin-right-tiny"></span> Lab 9
    </a>
  

  
    
    <a id="js-page__nav__next" class="c-page__nav__next" href="/modules-textbook/xenglish-r1a/xenglish-r1a-intro">
      English <span class="u-margin-right-tiny"></span> 〉
    </a>
  
</nav>

            </div>
          </div>
        </div>
      </main>
    </div>

  </body>
</html>
